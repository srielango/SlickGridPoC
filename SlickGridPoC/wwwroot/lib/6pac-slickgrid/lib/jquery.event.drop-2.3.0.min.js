!function(p){p.fn.drop=function(t,e,a){var n="string"==typeof t?t:"",i=p.isFunction(t)?t:p.isFunction(e)?e:null;return 0!==n.indexOf("drop")&&(n="drop"+n),a=(t==i?e:a)||{},i?this.on(n,a,i):this.trigger(n)},p.drop=function(t){m.multi=!0===(t=t||{}).multi?1/0:!1===t.multi?1:(isNaN(t.multi)?m:t).multi,m.delay=t.delay||m.delay,m.tolerance=p.isFunction(t.tolerance)?t.tolerance:null===t.tolerance?null:m.tolerance,m.mode=t.mode||m.mode||"intersect"};var h=p.event.special,m=p.event.special.drop={multi:1,delay:20,mode:"overlap",targets:[],datakey:"dropdata",noBubble:!0,add:function(t){p.data(this,m.datakey).related+=1},remove:function(){--p.data(this,m.datakey).related},setup:function(){p.data(this,m.datakey)||(p.data(this,m.datakey,{related:0,active:[],anyactive:0,winner:0,location:{}}),m.targets.push(this))},teardown:function(){var e;(p.data(this,m.datakey)||{}).related||(p.removeData(this,m.datakey),e=this,m.targets=p.grep(m.targets,function(t){return t!==e}))},handler:function(t,e){var a;if(e)switch(t.type){case"mousedown":case"touchstart":a=p(m.targets),(a="string"==typeof e.drop?a.filter(e.drop):a).each(function(){var t=p.data(this,m.datakey);t.active=[],t.anyactive=0,t.winner=0}),e.droppable=a,h.drag.hijack(t,"dropinit",e);break;case"mousemove":case"touchmove":m.event=t,m.timer||m.tolerate(e);break;case"mouseup":case"touchend":m.timer=clearTimeout(m.timer),e.propagates&&(h.drag.hijack(t,"drop",e),h.drag.hijack(t,"dropend",e))}},locate:function(t,e){var a=p.data(t,m.datakey),n=p(t),i=n.length&&!n.is(document)?n.offset():{},o=n.outerHeight(),n=n.outerWidth(),n={elem:t,width:n,height:o,top:i.top,left:i.left,right:i.left+n,bottom:i.top+o};return a&&(a.location=n,a.index=e,a.elem=t),n},contains:function(t,e){return(e[0]||e.left)>=t.left&&(e[0]||e.right)<=t.right&&(e[1]||e.top)>=t.top&&(e[1]||e.bottom)<=t.bottom},modes:{intersect:function(t,e,a){return this.contains(a,[t.pageX,t.pageY])?1e9:this.modes.overlap.apply(this,arguments)},overlap:function(t,e,a){return Math.max(0,Math.min(a.bottom,e.bottom)-Math.max(a.top,e.top))*Math.max(0,Math.min(a.right,e.right)-Math.max(a.left,e.left))},fit:function(t,e,a){return this.contains(a,e)?1:0},middle:function(t,e,a){return this.contains(a,[e.left+.5*e.width,e.top+.5*e.height])?1:0}},sort:function(t,e){return e.winner-t.winner||t.index-e.index},tolerate:function(t){var e,a,n,i,o,r,d,c=0,l=t.interactions.length,s=[m.event.pageX,m.event.pageY],u=m.tolerance||m.modes[m.mode];do{if(d=t.interactions[c]){if(!d)return;d.drop=[],i=[],o=d.droppable.length,u&&(a=m.locate(d.proxy)),e=0;do{if(r=d.droppable[e]){if(!(r=(n=p.data(r,m.datakey)).location))continue;n.winner=u?u.call(m,m.event,a,r):m.contains(r,s)?1:0,i.push(n)}}while(++e<o);for(i.sort(m.sort),e=0;(n=i[e])&&(n.winner&&d.drop.length<m.multi?(n.active[c]||n.anyactive||(!1!==h.drag.hijack(m.event,"dropstart",t,c,n.elem)[0]?(n.active[c]=1,n.anyactive+=1):n.winner=0),n.winner&&d.drop.push(n.elem)):n.active[c]&&1==n.anyactive&&(h.drag.hijack(m.event,"dropend",t,c,n.elem),n.active[c]=0,--n.anyactive)),++e<o;);}}while(++c<l);m.last&&s[0]==m.last.pageX&&s[1]==m.last.pageY?delete m.timer:m.timer=setTimeout(function(){m.tolerate(t)},m.delay),m.last=m.event}};h.dropinit=h.dropstart=h.dropend=m}(jQuery);